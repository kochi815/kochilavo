<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã­ã“ãƒãƒˆãƒ«ãƒãƒ£ãƒ¬ãƒ³ã‚¸</title>
  <style>
    body {
      font-family: 'M PLUS Rounded 1c', sans-serif;
      text-align: center;
      background-color: #fdf6e3;
      margin: 0;
      padding: 20px;
    }
    h1 {
      font-size: 2em;
      color: #ff6f61;
      margin-bottom: 15px;
    }
    #avatarDisplay {
      font-size: 2em;
      margin-bottom: 10px;
    }
    #enemyStatus, #playerStatus {
      font-size: 1.1em;
      margin: 10px 0;
    }
    #question {
      font-size: 2.5em;
      margin: 20px 0;
    }
    #battleLog {
      font-size: 1.2em;
      min-height: 2em;
      margin: 10px 0;
    }
    #answerInput {
      font-size: 1.5em;
      padding: 8px;
      width: 80px;
      margin-top: 10px;
      text-align: center;
      border: 2px solid #ffb347;
      border-radius: 10px;
    }
    button {
      font-size: 1.2em;
      padding: 10px 30px;
      margin: 10px;
      border-radius: 20px;
      border: none;
      background-color: #ffb347;
      color: white;
      font-weight: bold;
      cursor: pointer;
      min-width: 120px;
    }
    button:hover {
      background-color: #ff9933;
    }
    @media (max-width: 768px) {
      h1 { font-size: 1.8em; }
      #question { font-size: 2em; }
      #battleLog { font-size: 1.1em; }
      button { font-size: 1em; padding: 8px 20px; min-width: 100px; }
      #answerInput { font-size: 1.2em; width: 60px; }
    }
  </style>
</head>
<body>
  <h1>ã­ã“ãƒãƒˆãƒ«ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h1>
  <div id="avatarDisplay">ğŸ©ğŸ˜ºğŸŒˆ</div>
  <div id="enemyStatus">ğŸ¶ ??? (Lv <span id="enemyLevel">1</span>) - HP: <span id="enemyHP">10</span></div>
  <div id="playerStatus">ğŸ˜º ã«ã‚ƒã‚“ãŸã‚ã† - HP: <span id="playerHP">10</span></div>
  <div id="question">å•é¡Œè¡¨ç¤º</div>
  <input id="answerInput" type="number" placeholder="ç­”ãˆ">
  <div id="battleLog">æˆ¦é—˜ãƒ­ã‚°</div>
  <button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>

  <script>
    const totalQuestions = 10;
    let problems = [];
    let index = 0;
    let startTime;
    let playerHP = 10;
    let enemyHP = 10;
    let currentStage = 1;

    const startBtn = document.getElementById("startBtn");
    const questionDiv = document.getElementById("question");
    const battleLog = document.getElementById("battleLog");
    const enemyHPDisplay = document.getElementById("enemyHP");
    const enemyLevelDisplay = document.getElementById("enemyLevel");
    const playerHPDisplay = document.getElementById("playerHP");
    const avatarDisplay = document.getElementById("avatarDisplay");
    const enemyStatus = document.getElementById("enemyStatus");
    const answerInput = document.getElementById("answerInput");

    const equipped = { cat: "ğŸ˜º", hat: "ğŸ©", bg: "ğŸŒˆ" };

    // æ•µãƒªã‚¹ãƒˆï¼ˆLv1ã€œ30ï¼‰: HPã¯ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦ä¸Šæ˜‡
    const enemyList = Array.from({ length: 30 }, (_, i) => {
      const level = i + 1;
      return {
        name: `ã„ã¬Lv${level}`,
        emoji: "ğŸ¶",
        level,
        hp: 10 + Math.floor(level * 1.5)
      };
    });

    function updateAvatar() {
      avatarDisplay.textContent = `${equipped.hat}${equipped.cat}${equipped.bg}`;
    }

    function generateProblems() {
      problems = [];
      for (let a = 2; a < 10; a++) {
        for (let b = 2; b < 10; b++) {
          problems.push({ q: `${a} Ã— ${b}`, a: a * b });
        }
      }
      problems.sort(() => Math.random() - 0.5);
      problems = problems.slice(0, totalQuestions);
    }

    function showQuestion() {
      if (index >= problems.length || playerHP <= 0 || enemyHP <= 0) {
        endBattle();
        return;
      }
      const p = problems[index];
      questionDiv.textContent = p.q;
      startTime = Date.now();
      battleLog.textContent = "å›ç­”ã—ã¦ã­ï¼";
      answerInput.value = "";
      answerInput.focus();
    }

    function handleAnswer() {
      const elapsed = (Date.now() - startTime) / 1000;
      const p = problems[index];
      const userAnswer = parseInt(answerInput.value);
      if (isNaN(userAnswer)) return;

      if (userAnswer === p.a) {
        if (elapsed < 1.2) {
          enemyHP -= 5;
          battleLog.textContent = "Perfect! æ•µã«5ãƒ€ãƒ¡ãƒ¼ã‚¸!";
        } else if (elapsed < 2.0) {
          enemyHP -= 3;
          battleLog.textContent = "Great! æ•µã«3ãƒ€ãƒ¡ãƒ¼ã‚¸!";
        } else if (elapsed < 3.0) {
          enemyHP -= 1;
          battleLog.textContent = "Good! æ•µã«1ãƒ€ãƒ¡ãƒ¼ã‚¸";
        } else {
          playerHP -= 2;
          battleLog.textContent = "Too slow... ãƒŸã‚¹! è‡ªåˆ†ã«2ãƒ€ãƒ¡ãƒ¼ã‚¸!";
        }
      } else {
        playerHP -= 3;
        battleLog.textContent = "Wrong... è‡ªåˆ†ã«3ãƒ€ãƒ¡ãƒ¼ã‚¸!";
      }
      enemyHPDisplay.textContent = Math.max(enemyHP, 0);
      playerHPDisplay.textContent = Math.max(playerHP, 0);
      index++;
      showQuestion();
    }

    // ã“ã“ã§ã€å…¥åŠ›æ¬„ã®å†…å®¹ã‚’ç›£è¦–ã—ã¦ã€æ­£è§£ãªã‚‰è‡ªå‹•ã§å›ç­”å‡¦ç†ã‚’è¡Œã†
    answerInput.addEventListener("input", () => {
      if (startBtn.style.display !== "none") return; // ãƒãƒˆãƒ«ä¸­ã®ã¿æœ‰åŠ¹
      const p = problems[index];
      if (!p) return;
      if (parseInt(answerInput.value) === p.a) {
        handleAnswer();
      }
    });

    function startBattle() {
      const enemy = enemyList[currentStage - 1];
      enemyHP = enemy.hp;
      playerHP = 10;
      index = 0;
      generateProblems();
      updateAvatar();
      enemyHPDisplay.textContent = enemy.hp;
      enemyLevelDisplay.textContent = enemy.level;
      enemyStatus.innerHTML = `${enemy.emoji} ${enemy.name} (Lv ${enemy.level}) - HP: <span id="enemyHP">${enemy.hp}</span>`;
      startBtn.style.display = "none";
      answerInput.style.display = "inline-block";
      showQuestion();
    }

    function endBattle() {
      answerInput.style.display = "none";
      if (enemyHP <= 0) {
        battleLog.textContent = `å‹åˆ©ï¼ ${enemyList[currentStage - 1].name} ã‚’ãŸãŠã—ãŸï¼`;
        currentStage++;
        if (currentStage > enemyList.length) {
          battleLog.textContent += " å…¨ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ï¼ãŠã‚ã§ã¨ã†ï¼";
          startBtn.style.display = "none";
        } else {
          startBtn.textContent = `æ¬¡ã®æ•µ (Lv${currentStage}) ã¨æˆ¦ã†ï¼`;
          startBtn.style.display = "inline-block";
        }
      } else if (playerHP <= 0) {\n        battleLog.textContent = "æ•—åŒ—...ã¾ãŸæŒ‘æˆ¦ã—ã¦ã­ï¼";\n        startBtn.textContent = "å†æŒ‘æˆ¦ï¼";\n        startBtn.style.display = "inline-block";\n      } else {\n        battleLog.textContent = "æˆ¦é—˜çµ‚äº†!";\n        startBtn.style.display = "inline-block";\n      }\n      questionDiv.textContent = \"\";\n    }\n\n    startBtn.addEventListener(\"click\", () => {\n      startBattle();\n    });\n\n    // Enterã‚­ãƒ¼ã§ã‚‚å›ç­”å¯èƒ½\n    answerInput.addEventListener(\"keydown\", (e) => {\n      if (e.key === \"Enter\" && startBtn.style.display === \"none\") {\n        handleAnswer();\n      }\n    });\n  </script>\n</body>\n</html>"
    }
  ]
}
